# n8n + CLI Tools

Docker Compose setup for running n8n workflow automation with integrated CLI tools.

## Overview

This integration allows n8n workflows to execute CLI tools:
- **webscrape** - Scrape files from JavaScript-heavy pages
- **mdconvert** - Convert Markdown to PDF or DOCX
- **genimg** - Generate images with Google Imagen API
- **qrgen** - Generate branded QR codes

## Quick Start

```bash
# 1. Clone this repository
git clone https://github.com/orbruno/n8n-cli-tools.git
cd n8n-cli-tools

# 2. Create environment file
cp .env.example .env

# 3. Generate encryption key and update .env
echo "N8N_ENCRYPTION_KEY=$(openssl rand -hex 32)" >> .env

# 4. Set a secure password in .env
# Edit .env and set N8N_BASIC_AUTH_PASSWORD

# 5. Start the services
docker-compose up -d

# 6. Access n8n
open http://localhost:5678
```

## Architecture

```
┌─────────────────────────────────────────────────────┐
│                   Docker Network                     │
│                                                      │
│  ┌──────────────┐         ┌──────────────────────┐  │
│  │     n8n      │ ──────> │     cli-tools        │  │
│  │  :5678       │  exec   │  webscrape, mdconvert│  │
│  │              │         │  genimg, qrgen       │  │
│  └──────────────┘         └──────────────────────┘  │
│         │                          │                 │
│         └──────────┬───────────────┘                 │
│                    │                                 │
│              ┌─────┴─────┐                          │
│              │  shared   │                          │
│              │  volume   │                          │
│              │  /data    │                          │
│              └───────────┘                          │
└─────────────────────────────────────────────────────┘
```

## Using CLI Tools in n8n Workflows

### Method 1: Execute Command Node (Docker Exec)

Use the **Execute Command** node to run CLI tools:

```bash
# In n8n Execute Command node:
docker exec cli-tools webscrape scrape "https://example.com" --download -o /data/shared/
```

### Method 2: SSH Node (Recommended)

Configure SSH access to the cli-tools container for more reliable execution.

### Method 3: HTTP Request to Custom API

You can extend cli-tools with a simple HTTP API wrapper.

---

## Workflow Examples

### Example 1: Scrape Website and Convert to PDF

```
[Webhook Trigger]
    → [Execute Command: webscrape]
    → [Execute Command: mdconvert]
    → [Send Email with PDF]
```

**Execute Command 1 (webscrape):**
```bash
docker exec cli-tools webscrape scrape "{{ $json.url }}" -o /data/shared/scraped/
```

**Execute Command 2 (mdconvert):**
```bash
docker exec cli-tools mdconvert /data/shared/scraped/content.md /data/shared/output.pdf
```

### Example 2: Generate QR Code for URL

```
[Webhook with URL]
    → [Execute Command: qrgen]
    → [Read Binary File]
    → [Respond with Image]
```

**Execute Command:**
```bash
docker exec cli-tools qrgen "{{ $json.url }}" -o /data/shared/qr-{{ $json.id }}.png
```

### Example 3: Generate AI Image

```
[Webhook with Prompt]
    → [Execute Command: genimg]
    → [Upload to S3]
```

**Execute Command:**
```bash
docker exec cli-tools genimg "{{ $json.prompt }}" -o /data/shared/generated-image.png
```

---

## Shared Data Volume

The `/data/shared` volume is mounted in both n8n and cli-tools containers:

| Container | Path | Purpose |
|-----------|------|---------|
| n8n | `/data/shared` | Read/write files |
| cli-tools | `/data/shared` | Output directory for generated files |

### Reading Files in n8n

Use the **Read Binary File** node to read files generated by CLI tools:
- Path: `/data/shared/filename.pdf`

---

## Configuration

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `N8N_PORT` | n8n web interface port | `5678` |
| `N8N_BASIC_AUTH_USER` | Admin username | `admin` |
| `N8N_BASIC_AUTH_PASSWORD` | Admin password | (required) |
| `N8N_ENCRYPTION_KEY` | Encryption key for credentials | (required) |
| `CLI_TOOLS_AUTO_UPDATE` | Auto-update tools on start | `false` |
| `GOOGLE_AI_API_KEY` | API key for imagen-cli | (optional) |

### Customizing CLI Tools

Edit `cli-tools/cli-tools.yml` to enable/disable specific tools:

```yaml
tools:
  web-scraper-cli:
    enabled: true
  imagen-cli:
    enabled: false  # Disable if not needed
```

Then rebuild:
```bash
docker-compose build cli-tools
docker-compose up -d
```

---

## Updating

### Update n8n

```bash
docker-compose pull n8n
docker-compose up -d
```

### Update CLI Tools

```bash
# Option 1: Auto-update on container restart
docker-compose exec cli-tools update-cli-tools

# Option 2: Rebuild image
docker-compose build --no-cache cli-tools
docker-compose up -d
```

---

## Troubleshooting

### Check container logs

```bash
docker-compose logs -f n8n
docker-compose logs -f cli-tools
```

### Test CLI tools manually

```bash
docker exec -it cli-tools bash
webscrape --help
```

### Verify shared volume

```bash
# From n8n container
docker exec n8n ls -la /data/shared

# From cli-tools container
docker exec cli-tools ls -la /data/shared
```

---

## Security Notes

1. **Always set a strong password** for `N8N_BASIC_AUTH_PASSWORD`
2. **Generate a unique encryption key** with `openssl rand -hex 32`
3. **Never commit `.env`** file to version control
4. For production, use HTTPS with a reverse proxy (nginx, traefik)

---

## Related Repositories

- [cli-tools](https://github.com/orbruno/cli-tools) - CLI Tools Docker image
- [web-scraper-cli](https://github.com/orbruno/web-scraper-cli)
- [mdconvert-cli](https://github.com/orbruno/mdconvert-cli)
- [image-cli](https://github.com/orbruno/image-cli) (imagen-cli)
- [qr-gen-cli](https://github.com/orbruno/qr-gen-cli)

---

**Last Updated**: 2026-02-03
